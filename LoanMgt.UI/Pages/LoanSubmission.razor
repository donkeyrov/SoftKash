@page "/loansubmission"
 
@inject IToastService toastService
@inject IJSRuntime JSRuntime
@inject NavigationManager UriHelper
@inject LoanProductRepository loanProductRepo;
@inject BorrowerRepository borrowerRepo;
@inherits OwningComponentBase<LoanRepository>

<h3>Loan Submission</h3>

<div class="col-lg-12 control-section">
    <div class="content-wrapper">
        <div class="row">
            <SfGrid DataSource="@loans" Toolbar="@(new List<string>() { "Search" })" AllowPaging="true">
                <GridColumns>
                    <GridForeignColumn Field=@nameof(loan.BorrowerId) HeaderText="EMPLOYEE NUMBER" TextAlign="TextAlign.Left" ForeignKeyValue="EmployeeNo" Format="d" ForeignDataSource="@borrowers" ></GridForeignColumn>
                    <GridColumn HeaderText="OLD WAGE TYPE" TextAlign="TextAlign.Left" ></GridColumn>
                    <GridColumn HeaderText="NEW WAGE TYPE" TextAlign="TextAlign.Left" >8000</GridColumn>
                    <GridColumn Field=@nameof(loan.LoanEnd) HeaderText="END DATE"></GridColumn>
                    <GridColumn Field=@nameof(loan.LoanStart) HeaderText="START DATE"></GridColumn>
                    <GridColumn Field=@nameof(loan.FirstRepaymentAmount) HeaderText="INSTALMENT" TextAlign="TextAlign.Left" ></GridColumn>
                    <GridColumn HeaderText="PAYMENT METHOD ELECTRONIC/CHEQUE" TextAlign="TextAlign.Left" >E693</GridColumn>
                    <GridColumn  HeaderText="ZLSCH">E</GridColumn>

                    <GridForeignColumn Field=@nameof(loan.BorrowerId) HeaderText="NRC. NO" TextAlign="TextAlign.Left" ForeignKeyValue="NRC" Format="d" ForeignDataSource="@borrowers" ></GridForeignColumn>
                    <GridForeignColumn Field=@nameof(loan.BorrowerId) HeaderText="FIRST NAME" TextAlign="TextAlign.Left" ForeignKeyValue="Firstname" Format="d" ForeignDataSource="@borrowers" ></GridForeignColumn>
                    <GridForeignColumn Field=@nameof(loan.BorrowerId) HeaderText="SURNAME" TextAlign="TextAlign.Left" ForeignKeyValue="Lastname" Format="d" ForeignDataSource="@borrowers" ></GridForeignColumn>
                </GridColumns>
            </SfGrid>
        </div>
    </div>
</div>

@code {
    private LoanMgt.SHARED.Loan loan = new LoanMgt.SHARED.Loan();
    private IEnumerable<LoanMgt.SHARED.Loan> loans { get; set; } = new List<LoanMgt.SHARED.Loan>();
    private IEnumerable<LoanMgt.SHARED.LoanProduct> loanProducts { get; set; } = new List<LoanMgt.SHARED.LoanProduct>();
    private IEnumerable<LoanMgt.SHARED.Borrower> borrowers { get; set; } = new List<LoanMgt.SHARED.Borrower>();

    protected override void OnInitialized()
    {
        loans = Service.GetAll().Where(l=> (l.LoanStatusId == 2 || (l.LoanStatusId == 1 && l.ApproverStage == 1) ) && l.Closed == false && l.Suspended == false).ToList();
        borrowers = borrowerRepo.GetAll();
        loanProducts = loanProductRepo.GetAll();
    }

    protected void EditRecord(Microsoft.AspNetCore.Components.Web.MouseEventArgs args, LoanMgt.SHARED.Loan myLoan)
    {
        UriHelper.NavigateTo("/addloan/"+ myLoan.LoanId);
    }
}

